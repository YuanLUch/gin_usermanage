{"remainingRequest":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\src\\views\\sys\\role.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\src\\views\\sys\\role.vue","mtime":1712626992073},{"path":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1702824123341},{"path":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\node_modules\\babel-loader\\lib\\index.js","mtime":1702824125233},{"path":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1702824123341},{"path":"D:\\GraduationProject\\NPU-DatabaseMigration\\vue-new\\node_modules\\vue-loader\\lib\\index.js","mtime":1702824125775}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IHRva2VuID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKQpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9yaWdpblBhc3N3b3JkOiAnJywKICAgICAgY2hhbmdlUGFzc3dvcmQ6IHsKICAgICAgICBpZDogMCwKICAgICAgICBvcmlnaW5wYXNzOiAnJywKICAgICAgICBwYXNzd29yZDogJycsCiAgICAgICAgY2hlY2tQYXNzOiAnJywKICAgICAgfSwKICAgICAgY2hhbmdlUGFzc3dvcmRSdWxlczogewogICAgICAgIG9yaWdpbnBhc3M6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgdmFsaWRhdG9yOiAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhbmdlUGFzc3dvcmQub3JpZ2lucGFzcyA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign6K+36L6T5YWl5Y6f5a+G56CBJykpCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRyaWdnZXI6ICdibHVyJywKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgewogICAgICAgICAgICB2YWxpZGF0b3I6IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgICAgICAgICBpZiAodGhpcy5jaGFuZ2VQYXNzd29yZC5wYXNzd29yZCA9PSAnJykgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCfor7fovpPlhaXlr4bnoIEnKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKFsuLi50aGlzLmNoYW5nZVBhc3N3b3JkLnBhc3N3b3JkXS5sZW5ndGggPCA2IHx8IFsuLi50aGlzLmNoYW5nZVBhc3N3b3JkLnBhc3N3b3JkXS5sZW5ndGggPiAyMCkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCflr4bnoIHlupTlvZPlnKg25YiwMjDkvY3kuYvpl7QnKSkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbGJhY2soKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJpZ2dlcjogJ2JsdXInLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgIGNoZWNrcGFzczogWwogICAgICAgICAgewogICAgICAgICAgICB2YWxpZGF0b3I6IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgICAgICAgICBpZiAodGhpcy5jaGFuZ2VQYXNzd29yZC5jaGVja3Bhc3MgPT0gJycpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign6K+36L6T5YWl5a+G56CBJykpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZVBhc3N3b3JkLnBhc3N3b3JkICE9PSB0aGlzLmNoYW5nZVBhc3N3b3JkLmNoZWNrcGFzcykgewogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCflr4bnoIHkuI3kuIDoh7TvvIzor7fph43mlrDovpPlhaUnKSkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FsbGJhY2soKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJpZ2dlcjogJ2JsdXInLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICB9LAogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0VXNlckluZm8oKQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZ2V0VXNlckluZm8oKSB7CiAgICAgICAgY29uc3QgdG9rZW4gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpCiAgICAgICAgY29uc3Qge2RhdGE6cmVzfSA9IGF3YWl0IHRoaXMuJGh0dHAuZ2V0KCd1c2VyL2luZm8nLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0b2tlbn1gIAogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgdGhpcy5vcmlnaW5QYXNzd29yZCA9IHJlcy5kYXRhLnBhc3N3b3JkCiAgICAgICAgLy8gY29uc29sZS5sb2coIuWOn+Wvhuegge+8miIsIHRoaXMub3JpZ2luUGFzc3dvcmQpCiAgICB9LAogICAgYXN5bmMgY2hhbmdlUGFzc3dvcmRPaygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCdzY3J5cHQvcGFzcycsewogICAgICAgIG9yaWdpblBhc3M6IHRoaXMuY2hhbmdlUGFzc3dvcmQub3JpZ2lucGFzcwogICAgICB9KQogICAgICBjb25zdCBzY3J5cHRPcmlnaW4gPSByZXMuZGF0YS5zY3J5UGFzcwogICAgICAvLyBjb25zb2xlLmxvZygi5Yqg5a+G5ZCO55qE5Y6f5a+G56CB77yaIiwgc2NyeXB0T3JpZ2luKQogICAgICB0aGlzLiRyZWZzLmNoYW5nZVBhc3N3b3JkUmVmLnZhbGlkYXRlKGFzeW5jICh2YWxpZCkgPT4gewogICAgICAgIGNvbnN0IHRva2VuID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKQogICAgICAgIGlmICghdmFsaWQpIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCflj4LmlbDkuI3nrKblkIjopoHmsYLvvIzor7fph43mlrDovpPlhaUnKQogICAgICAgIGlmICh0aGlzLm9yaWdpblBhc3N3b3JkICE9PSBzY3J5cHRPcmlnaW4gKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfljp/lr4bnoIHovpPlhaXplJnor68nKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB7IGRhdGE6IHJlcyB9ID0gYXdhaXQgdGhpcy4kaHR0cC5wdXQoJ3VzZXIvY2hhbmdlcHcnLCB7CiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmNoYW5nZVBhc3N3b3JkLnBhc3N3b3JkLAogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0b2tlbn1gIAogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLy8gY29uc29sZS5sb2coIuS/ruaUueWvhueggeWQjueahHJlczoiLCByZXMpCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgIT0gMjAwKSByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubWVzc2FnZSkKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+S/ruaUueWvhueggeaIkOWKnycpCiAgICAgICAgfQogICAgICAgIAogICAgICB9KQogICAgfSwKICAgIGNoYW5nZVBhc3N3b3JkQ2FuY2VsKCkgewogICAgICB0aGlzLiRyZWZzLmNoYW5nZVBhc3N3b3JkUmVmLnJlc2V0RmllbGRzKCkKICAgICAgdGhpcy4kbWVzc2FnZS5pbmZvKCflt7Llj5bmtognKQogICAgfSwKICB9Cn0KCg=="},{"version":3,"sources":["role.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"role.vue","sourceRoot":"src/views/sys","sourcesContent":["<template>\n  <el-card>\n    <el-form :model=\"changePassword\" :rules=\"changePasswordRules\" ref=\"changePasswordRef\">\n      <!-- 本想设计在修改密码时验证一遍原密码，原密码经过加密，需要后端先新建密码加密接口，传入新密码加密后返回与原密码比对 -->\n        <el-form-item label=\"原密码\">\n          <el-input v-model=\"changePassword.originpass\" type=\"password\"></el-input>\n        </el-form-item>\n        <el-form-item has-feedback label=\"新密码\" prop=\"password\">\n          <el-input v-model=\"changePassword.password\" type=\"password\"></el-input>\n        </el-form-item>\n        <el-form-item has-feedback label=\"确认密码\" prop=\"checkpass\">\n          <el-input v-model=\"changePassword.checkpass\" type=\"password\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div class=\"user-edit-buttons\">\n        <el-button type=\"primary\" @click=\"changePasswordOk\">确 定</el-button>\n        <el-button type=\"danger\" @click=\"changePasswordCancel\">取 消</el-button>\n      </div>\n  </el-card>\n  \n</template>\n\n<script>\nconst token = sessionStorage.getItem('token')\nexport default {\n  data() {\n    return {\n      originPassword: '',\n      changePassword: {\n        id: 0,\n        originpass: '',\n        password: '',\n        checkPass: '',\n      },\n      changePasswordRules: {\n        originpass: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.changePassword.originpass === '') {\n                callback(new Error('请输入原密码'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        password: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.changePassword.password == '') {\n                callback(new Error('请输入密码'))\n              }\n              if ([...this.changePassword.password].length < 6 || [...this.changePassword.password].length > 20) {\n                callback(new Error('密码应当在6到20位之间'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n        checkpass: [\n          {\n            validator: (rule, value, callback) => {\n              if (this.changePassword.checkpass == '') {\n                callback(new Error('请输入密码'))\n              }\n              if (this.changePassword.password !== this.changePassword.checkpass) {\n                callback(new Error('密码不一致，请重新输入'))\n              } else {\n                callback()\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n      },\n    }\n  },\n  created() {\n    this.getUserInfo()\n  },\n  methods: {\n    async getUserInfo() {\n        const token = sessionStorage.getItem('token')\n        const {data:res} = await this.$http.get('user/info', {\n          headers: {\n                'Authorization': `Bearer ${token}` \n          }\n        })\n        this.originPassword = res.data.password\n        // console.log(\"原密码：\", this.originPassword)\n    },\n    async changePasswordOk() {\n      const res = await this.$http.post('scrypt/pass',{\n        originPass: this.changePassword.originpass\n      })\n      const scryptOrigin = res.data.scryPass\n      // console.log(\"加密后的原密码：\", scryptOrigin)\n      this.$refs.changePasswordRef.validate(async (valid) => {\n        const token = sessionStorage.getItem('token')\n        if (!valid) return this.$message.error('参数不符合要求，请重新输入')\n        if (this.originPassword !== scryptOrigin ) {\n          this.$message.error('原密码输入错误')\n        } else {\n          const { data: res } = await this.$http.put('user/changepw', {\n            password: this.changePassword.password,\n          }, {\n            headers: {\n                'Authorization': `Bearer ${token}` \n          }\n        })\n        // console.log(\"修改密码后的res:\", res)\n        if (res.status != 200) return this.$message.error(res.message)\n        this.$message.success('修改密码成功')\n        }\n        \n      })\n    },\n    changePasswordCancel() {\n      this.$refs.changePasswordRef.resetFields()\n      this.$message.info('已取消')\n    },\n  }\n}\n\n</script>\n\n<style>\n.user-edit-buttons {\n  text-align: center;\n  margin-top: 20px;\n}\n</style>\n"]}]}